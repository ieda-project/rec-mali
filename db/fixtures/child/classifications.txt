$version 1

######################
## Signes de danger ##
######################

@signes_danger = danger.boire OR danger.vomit OR danger.convulsions_passe OR danger.lethargie OR danger.convulsions_present

danger|Pas de signe général de danger|low|!@signes_danger
danger|Signe général de danger présent|high|@signes_danger

##########
## Toux ##
##########

@pneumonie_grave = @signes_danger OR toux.stridor
@pneumonie = ((enfant.months >= 12) AND (toux.freq_resp >= 40)) OR ((enfant.months < 12) AND (toux.freq_resp >= 50)) OR toux.tirage

toux|Pas de pneumonie : toux ou rhume|low|toux.toux_presence AND !@pneumonie AND !@pneumonie_grave
toux|Pneumonie|medium|toux.toux_presence AND @pneumonie AND !@pneumonie_grave
toux|Pneumonie grave ou maladie très grave|high|toux.toux_presence AND @pneumonie_grave

##############
## Diarrhée ##
##############

@deshydratation_severe = diarrhee.diarrhee_presence AND AT_LEAST_TWO_OF(diarrhee.conscience_agitation == lethargique_inconscient, diarrhee.yeux_enfonces, diarrhee.soif == impossible, diarrhee.pli_cutane == tres_lentement)

@deshydratation_evident = diarrhee.diarrhee_presence AND AT_LEAST_TWO_OF(diarrhee.conscience_agitation == agite_irritable, diarrhee.yeux_enfonces, diarrhee.soif == avide, diarrhee.pli_cutane == lentement) AND !@deshydratation_severe

@pas_de_deshydratation = diarrhee.diarrhee_presence AND !@deshydratation_evident AND !@deshydratation_severe

@diarrhee_persistente_severe = diarrhee.diarrhee_presence AND (diarrhee.diarrhee_presence_duree >= 14) AND (@deshydratation_severe OR @deshydratation_evident)

@diarrhee_persistente = diarrhee.diarrhee_presence AND (diarrhee.diarrhee_presence_duree >= 14) AND @pas_de_deshydratation

diarrhee|Pas de déshydratation|low|@pas_de_deshydratation
diarrhee|Signes évidents de déshydratation|medium|@deshydratation_evident
diarrhee|Déshydratation sévère|high|@deshydratation_severe
diarrhee|Diarrhée persistente|medium|@diarrhee_persistente
diarrhee|Diarrhée persistente sévère|high|@diarrhee_persistente_severe
diarrhee|Dysenterie|medium|diarrhee.diarrhee_presence AND diarrhee.sang_selles

#######################
## Fièvre / Rougeole ##
#######################

@paludisme_grave = fievre.fievre_presence AND (@signes_danger OR fievre.raideur_nuque OR fievre.fontanelle OR fievre.urines_foncees OR fievre.comportement OR fievre.prostration OR diarrhee.conscience_agitation == lethargique_inconscient OR fievre.choc OR fievre.ictere OR fievre.saignements_spontanes OR fievre.paleur_severe OR toux.tirage OR toux.stridor)
@tdr_positif = fievre.tdr == tdr+

fievre|Maladie fébrile très grave ou paludisme grave|high|@paludisme_grave
fievre|Paludisme simple|medium|fievre.fievre_presence AND @tdr_positif AND !@paludisme_grave
fievre|Fièvre : pas de paludisme|low|fievre.fievre_presence AND !@tdr_positif AND !@paludisme_grave

@rougeole_actuelle = fievre.eruptions AND (fievre.ecoulement_nasal OR fievre.yeux_rouge OR toux.toux_presence)
@rougeole_ou_antecedent = fievre.antecedent_rougeole OR @rougeole_actuelle
@rougeole_compliquee = fievre.fievre_presence AND @rougeole_ou_antecedent AND (@signes_danger OR fievre.cornee OR fievre.ulcerations == profondes_etendues)
@rougeole_yeux_bouche = fievre.fievre_presence AND @rougeole_ou_antecedent AND (fievre.ecoulement_oculaire OR fievre.ulcerations == presentes)

fievre|Rougeole grave et compliquée|high|@rougeole_compliquee
fievre|Rougeole avec complication aux yeux et/ou la bouche|medium|@rougeole_yeux_bouche AND !@rougeole_compliquee
fievre|Rougeole|medium|fievre.fievre_presence AND @rougeole_actuelle AND !@rougeole_yeux_bouche AND !@rougeole_compliquee
fievre|Antécédent de rougeole|low|fievre.fievre_presence AND fievre.antecedent_rougeole AND !@rougeole_actuelle AND !@rougeole_yeux_bouche AND !@rougeole_compliquee

#############
## Oreille ##
#############

@mastoidite = oreille.oreille_gonflement
@infection_aigue = ((oreille.oreille_ecoulement AND oreille.oreille_ecoulement_duree < 14) OR oreille.oreille_douleur)
@infection_chronique = (oreille.oreille_ecoulement AND oreille.oreille_ecoulement_duree >= 14)

oreille|Mastoïdite|high|oreille.oreille_probleme AND @mastoidite
oreille|Infection aiguë de l'oreille|medium|oreille.oreille_probleme AND @infection_aigue AND !@mastoidite
oreille|Infection chronique de l'oreille|medium|oreille.oreille_probleme AND @infection_chronique AND !@infection_aigue AND !@mastoidite
oreille|Pas d'infection d'oreille|low|oreille.oreille_probleme AND !@mastoidite AND !@infection_aigue AND !@infection_chronique

############
## Anémie ##
############

@anemie_grave = anemie.paleur_palmaire == severe OR (anemie.depranocytose AND (fievre.ictere OR fievre.fievre_presence OR anemie.crises OR anemie.priapisme))

anemie|Anémie grave|high|@anemie_grave
anemie|Anémie|medium|anemie.paleur_palmaire == legere AND !@anemie_grave
anemie|Pas d'anémie|low|anemie.paleur_palmaire == absente AND !@anemie_grave




# @classifications_graves = @signes_danger OR @pneumonie_grave OR @deshydratation_severe OR @diarrhee_persistente_severe OR @rougeole_compliquee OR @paludisme_grave OR @anemie_grave OR @mastoidite
#
#
#
# @ma_normal = (enfant.muac >= 125) AND (enfant.wfh >= 80)
# @ma_mam = (enfant.muac >= 115) AND (enfant.wfh >= 70) AND !@ma_normal
# @ma_mas = (enfant.muac < 115) OR (enfant.wfh < 70)
#
# malnutrition|Non applicable : enfant de moins de 6 mois|low|enfant.months < 6
# malnutrition|Pas de malnutrition|low|(enfant.months >= 6) AND @ma_normal AND (malnutrition.oedemes == no)
# malnutrition|MAM|medium|(enfant.months >= 6) AND @ma_mam AND (malnutrition.oedemes == no)
# malnutrition|MASs|medium|(enfant.months >= 6) AND @ma_mas AND (malnutrition.test_appetit == positif) AND (malnutrition.oedemes == no) AND !@classifications_graves
# malnutrition|MASc|high|(enfant.months >= 6) AND ((malnutrition.oedemes != no) OR (@ma_mas AND ((malnutrition.test_appetit == negatif) OR @classifications_graves)))
#
#
#
# @au_plus_une_maladie = AT_MOST_ONE_OF(@pneumonie_grave, vih.pneumonie_recidivante, vih.diarrhee_dernierement, oreille.oreille_ecoulement, (enfant.months >= 6) AND !@ma_normal, vih.candidose_buccale, vih.hypertrophie_ganglions_lymphatiques, vih.augmentation_glande_parotide, @diarrhee_persistente OR @diarrhee_persistente_severe)
#
# @au_moins_deux_maladies = AT_LEAST_TWO_OF(@pneumonie_grave, vih.pneumonie_recidivante, vih.diarrhee_dernierement, oreille.oreille_ecoulement, (enfant.months >= 6) AND !@ma_normal, vih.candidose_buccale, vih.hypertrophie_ganglions_lymphatiques, vih.augmentation_glande_parotide, @diarrhee_persistente OR @diarrhee_persistente_severe)
#
# @infection_vih_symp_suspecte = (vih.serologie_enfant == inconnue) AND (vih.serologie_mere == inconnue) AND @au_moins_deux_maladies
#
# vih|Pas d'infection à VIH|low|(vih.serologie_enfant == negative) AND (vih.serologie_mere == negative) AND @au_plus_une_maladie
# vih|Infection à VIH peu problable|low|(vih.serologie_enfant == inconnue) AND (vih.serologie_mere == inconnue) AND @au_plus_une_maladie AND !@infection_vih_symp_suspecte
# vih|Infection à VIH symptomatique suspecte|medium|@infection_vih_symp_suspecte
# vih|Infection à VIH possible / exposition au VIH|medium|(((vih.serologie_mere == positive) AND (vih.serologie_enfant == inconnue)) OR ((enfant.months < 18) AND (vih.serologie_enfant == positive))) AND @au_plus_une_maladie
# vih|Infection à VIH symptomatique probable|medium|((vih.serologie_enfant == positive) AND (enfant.months < 18)) AND @au_moins_deux_maladies
# vih|Infection à VIH confirmée|medium|(((vih.serologie_enfant == positive) AND (enfant.months >= 18)) OR (vih.test_enfant == positif)) AND @au_plus_une_maladie
# vih|Infection à VIH symptomatique confirmée|medium|(((vih.serologie_enfant == positive) AND (enfant.months >= 18)) OR (vih.test_enfant == positif)) AND @au_moins_deux_maladies
#
yield
